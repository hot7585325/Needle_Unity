var ii=Object.defineProperty;var ri=(s,t,i)=>t in s?ii(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var K=(s,t,i)=>(ri(s,typeof t!="symbol"?t+"":t,i),i);import{serializable as o,RectTransform as si,Behaviour as l,Mathf as w,GameObject as m,OrbitControls as zt,Text as Y,NeedleXRSession as ct,getTempVector as v,Camera as be,serializeable as u,WebXR as ni,setWorldPosition as pt,Rigidbody as D,AudioSource as N,InstantiateOptions as ai,Renderer as y,InstancingUtil as oi,Button as Ut,ActionBuilder as _,USDObject as ht,BehaviorModel as $,TriggerBuilder as A,Volume as li,getWorldPosition as Et,getParam as P,Gizmos as M,ParticleSystem as Vt,setParamWithoutReload as Wt,EventList as b,setWorldQuaternion as ce,getWorldQuaternion as pe,Animator as Gt,WebXRImageTracking as hi,DeviceUtilities as x,LODGroup as ci,syncField as z,showBalloonMessage as f,AssetReference as xe,screenshot2 as pi,DragControls as di,Animation as mt,USDZExporter as Rt,isDevEnvironment as Q,delay as Mt,SceneSwitcher as mi,RoomEvents as ui,Collider as ut,LogType as ve,WaitForSeconds as fi,isMobileDevice as gi,NeedleMenu as bi,getTempQuaternion as xi,AnimationCurve as vi,NeedleXRController as de,XRControllerFollow as wi,delayForFrames as Ht,MeshRenderer as _i,ParticleSystemShapeType as Dt,isDestroyed as we,instantiate as Oi,AnimationExtension as yi,PlayAnimationOnClick as me,getOrAddComponent as Pi,FileReference as ft,findObjectOfType as _e,ImageReference as Ci,PlayableDirector as ji,TypeStore as h}from"./needle-engine@4.6.1.js";import{l as Oe,P as Si,ax as C,v as dt,c as ye,h as Pe,aP as $t,V as O,e as Di,M as Ti,T as Ei,r as Mi,q as $i,b as Ai,bf as Ii,bA as Li,bJ as Fi,cS as Ni,cT as zi,am as ue,Z as Ui,cJ as Vi,cu as Wi,cz as Gi,cU as Ri}from"./three@0.169.5.js";import{C as Hi,a as qi,b as Ki}from"./three-examples.c78bc140.js";import"./gltf-progressive.28c3023d.js";import"./three-mesh-ui.78422980.js";import"./index-9ff1e98c.js";import"./three-quarks.78170687.js";var Qi=Object.defineProperty,Yi=Object.getOwnPropertyDescriptor,Ce=(s,t,i,r)=>{for(var e=r>1?void 0:r?Yi(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Qi(t,i,e),e};class qt extends l{constructor(){super(...arguments),this.safeArea=new Oe(0,0)}update(){var e,n,a;const t=this.context.domWidth/this.safeArea.x,i=this.context.domHeight/this.safeArea.y,r=w.clamp(Math.min(t,i),0,1);(e=this.rectTransform)==null||e.scale.setScalar(r),(a=(n=this.rectTransform)==null?void 0:n.shadowComponent)==null||a.scale.setScalar(r)}}Ce([o(si)],qt.prototype,"rectTransform",2);Ce([o(Oe)],qt.prototype,"safeArea",2);var Zi=Object.defineProperty,ki=Object.getOwnPropertyDescriptor,Kt=(s,t,i,r)=>{for(var e=r>1?void 0:r?ki(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Zi(t,i,e),e};class gt extends l{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=m.findObjectOfType(zt)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var r;this.menuButton&&this.removeButton();const t=((r=this.gameObject.getComponentInChildren(Y))==null?void 0:r.text)??this.gameObject.name,i=document.createElement("button");this.menuButton=i,i.innerText=t.replace("_"," "),i.setAttribute("priority","40"),i.addEventListener("click",()=>this.use()),this.context.menu.appendChild(i)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var i,r;(i=this.orbitalCamera)==null||i.setCameraTargetPosition(this.worldPosition);const t=(r=ct.active)==null?void 0:r.rig;if(this.teleportVRPlayer&&this.context.isInVR&&t){const e=v(this.worldPosition);this.ignoreYInVR&&(e.y=t.gameObject.worldPosition.y),t.gameObject.worldPosition=e}}}Kt([o()],gt.prototype,"createMenuButton",2);Kt([o()],gt.prototype,"teleportVRPlayer",2);Kt([o()],gt.prototype,"ignoreYInVR",2);class Bi extends l{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(be),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const t=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof Si&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=t}}var Xi=Object.defineProperty,Ji=Object.getOwnPropertyDescriptor,bt=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ji(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Xi(t,i,e),e};class Z extends l{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=t=>{t.button===0&&this.throwBall(t.space.worldPosition,t.space.worldForward)}}start(){this.prefab&&m.setActive(this.prefab,!1),this.webXR??(this.webXR=m.findObjectOfType(ni))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(t,i){var a,c;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const p=new ai;p.position=t;const d=m.instantiate(this.prefab,p);if(!d)return;this._instances.push(d)}const r=++this._index,e=this._instances[r%this._instances.length];if(!e)return;pt(e,t),m.setActive(e,!0),(a=this.audioSource)==null||a.stop(),(c=this.audioSource)==null||c.play();const n=m.getComponent(e,D);n&&(i.multiplyScalar(this.strength),n.resetForcesAndTorques(),n.resetVelocities(),n==null||n.applyImpulse(i))}}bt([u(C)],Z.prototype,"prefab",2);bt([u(N)],Z.prototype,"audioSource",2);bt([u()],Z.prototype,"strength",2);bt([u()],Z.prototype,"maxInstances",2);var tr=Object.defineProperty,er=Object.getOwnPropertyDescriptor,je=(s,t,i,r)=>{for(var e=r>1?void 0:r?er(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&tr(t,i,e),e};class Qt extends l{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const t=this.gameObject.getComponent(y);if(!t)return;for(let i=0;i<t.sharedMaterials.length;i++)t.sharedMaterials[i]=t.sharedMaterials[i].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const t=this.gameObject.getComponent(y);if(!t){console.warn("Can not change color: No renderer on "+this.name);return}for(let i=0;i<t.sharedMaterials.length;i++){const r=t.sharedMaterials[i];r.color=new dt(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&r instanceof ye&&(r.metalness=Math.random(),r.roughness=Math.random()*Math.random()),r.needsUpdate=!0,oi.markDirty(this.gameObject)}}}je([u()],Qt.prototype,"applyOnStart",2);je([u()],Qt.prototype,"randomMetallicRoughness",2);class ir extends l{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(y),!!this.renderer){this._startColor||(this._startColor=[]);for(let t=0;t<this.renderer.sharedMaterials.length;t++)this.renderer.sharedMaterials[t]=this.renderer.sharedMaterials[t].clone(),this._startColor[t]=this.renderer.sharedMaterials[t].color.clone()}}onCollisionEnter(t){if(this.renderer){this.collisionCount+=1;for(let i=0;i<this.renderer.sharedMaterials.length;i++)this.renderer.sharedMaterials[i].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(t){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let i=0;i<this.renderer.sharedMaterials.length;i++)this.renderer.sharedMaterials[i].color.copy(this._startColor[i])}}var rr=Object.defineProperty,sr=Object.getOwnPropertyDescriptor,nr=(s,t,i,r)=>{for(var e=r>1?void 0:r?sr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&rr(t,i,e),e};class Se extends l{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}nr([o(Pe)],Se.prototype,"myMaterial",2);var ar=Object.defineProperty,or=Object.getOwnPropertyDescriptor,lr=(s,t,i,r)=>{for(var e=r>1?void 0:r?or(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&ar(t,i,e),e};class De extends l{click(){var t,i;(i=(t=this.buttonToClick)==null?void 0:t.onClick)==null||i.invoke()}}lr([o(Ut)],De.prototype,"buttonToClick",2);var hr=Object.defineProperty,cr=Object.getOwnPropertyDescriptor,pr=(s,t,i,r)=>{for(var e=r>1?void 0:r?cr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&hr(t,i,e),e};class Te extends l{constructor(){super(...arguments),this.objectToMatrix=new Map}start(){var t;(t=this.target)==null||t.traverse(i=>{this.objectToMatrix.set(i,i.matrix.clone())})}onPointerClick(t){for(const[i,r]of this.objectToMatrix)i.matrix.copy(r),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0}createBehaviours(t,i,r){if(i.uuid!==this.gameObject.uuid||!this.target)return;const e=_.parallel();for(const[p,d]of this.objectToMatrix){const g=ht.createEmpty();g.matrix=d,p.parent&&g.matrix.premultiply(p.parent.matrixWorld),r.document.add(g),e.addAction(_.transformAction(p,g,0,"absolute","none"))}const n=new $("click_to_reset",A.tapTrigger(this.gameObject),e);t.addBehavior(n);const a=ht.createEmpty();a.name="InputTarget",a.displayName=void 0,a.type="RealityKitComponent",a.onSerialize=p=>{p.appendLine("bool allowsDirectInput = 1"),p.appendLine("bool allowsIndirectInput = 1"),p.appendLine('uniform token info:id = "RealityKit.InputTarget"')},i.add(a);const c=ht.createEmpty();c.name="HoverEffect",c.displayName=void 0,c.type="RealityKitComponent",c.onSerialize=p=>{p.appendLine('uniform token info:id = "RealityKit.HoverEffect"')},i.add(c)}}pr([o(m)],Te.prototype,"target",2);var dr=Object.defineProperty,mr=Object.getOwnPropertyDescriptor,Yt=(s,t,i,r)=>{for(var e=r>1?void 0:r?mr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&dr(t,i,e),e};class xt extends l{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var t,i,r;this.volume=m.findObjectOfType(li),this.dofEffect=(r=(i=(t=this.volume)==null?void 0:t.sharedProfile)==null?void 0:i.components)==null?void 0:r.find(e=>e.typeName==="DepthOfField"),this.orbit=m.findObjectOfType(zt)}onBeforeRender(){var i;if(!((i=this.orbit)!=null&&i.controls))return;const t=this.orbit.controls.target.distanceTo(Et(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=t,this.dofEffect.focalLength.value=this.focalLength;let r=w.inverseLerp(0,this.focusDistanceCutoff,t);r=w.clamp01(r),this.dofEffect.aperture.value=w.lerp(this.apertureMultiplier,32,r);const e=this.focusDistanceCutoff;t>e&&this.dofEffect.active?this.dofEffect.active=!1:t<e&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}Yt([o()],xt.prototype,"apertureMultiplier",2);Yt([o()],xt.prototype,"focalLength",2);Yt([o()],xt.prototype,"focusDistanceCutoff",2);class ur extends l{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var fr=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,br=(s,t,i,r)=>{for(var e=r>1?void 0:r?gr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&fr(t,i,e),e};const xr=P("sample_debugParticlesOnClick");class Ee extends l{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const t=this.context.physics.raycast();t.length>0&&this.spawnParticlesAt(t[0].point)}}onUpdateXR(t){t.xr.controllers.forEach(i=>{var r,e;if(((r=i.getButton("primary"))==null?void 0:r.isDown)===!0){const n=(e=this.context.physics.raycastFromRay(i.ray))==null?void 0:e.at(0);n&&this.spawnParticlesAt(n.point)}})}spawnParticlesAt(t){pt(this.gameObject,t),xr&&M.DrawWireSphere(t,.5,16711680,1);for(const i of this.particleSystems)i&&(m.setActive(i.gameObject,!0),i.play())}}br([u(Vt)],Ee.prototype,"particleSystems",2);var vr=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,_r=(s,t,i,r)=>{for(var e=r>1?void 0:r?wr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&vr(t,i,e),e};class Me extends l{constructor(){super(...arguments),this.parameters=[]}awake(){var t=!1;this.parameters.forEach(i=>{P(i)||(Wt(i,""),t=!0)}),t&&window.location.reload()}}_r([o()],Me.prototype,"parameters",2);var Or=Object.defineProperty,yr=Object.getOwnPropertyDescriptor,$e=(s,t,i,r)=>{for(var e=r>1?void 0:r?yr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Or(t,i,e),e};class Zt extends l{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new b,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}$e([u()],Zt.prototype,"htmlSelector",2);$e([o(b)],Zt.prototype,"onClick",2);var Pr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,Ae=(s,t,i,r)=>{for(var e=r>1?void 0:r?Cr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Pr(t,i,e),e};class kt extends l{constructor(){super(...arguments),this.createdElements=[]}onEnable(){var t;if(!(!this.methods||!this.names))for(let i=0;i<this.methods.length;i++){const r=this.methods[i];let e="Button";i<((t=this.names)==null?void 0:t.length)&&(e=this.names[i]);const n=document.createElement("button");n.innerHTML=e,n.onclick=()=>{r.invoke()},this.context.menu.appendChild(n),this.createdElements.push(n)}}onDisable(){for(const t of this.createdElements)t.remove()}reloadPageInSeconds(t){setTimeout(()=>{location.reload()},t*1e3)}}Ae([o(b)],kt.prototype,"methods",2);Ae([o()],kt.prototype,"names",2);var jr=Object.defineProperty,Sr=Object.getOwnPropertyDescriptor,vt=(s,t,i,r)=>{for(var e=r>1?void 0:r?Sr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&jr(t,i,e),e};class k extends l{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new $t().setFromAxisAngle(new O(0,1,0),Math.PI)}start(){const t=P("url");t&&(this.url=t);const i=document.createElement("div");i.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',i.style.zIndex="10000",i.style.position="absolute",i.style.pointerEvents="initial";const r=i.querySelector("iframe");r.addEventListener("load",()=>{setTimeout(()=>{var p;console.log("Automatically opening iframe"),(p=this.animator)==null||p.SetBool("Open",!0)},1e3)}),r.src=this.url;let e=1e3;const n=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),a=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);e=Math.max(n,a),r.width=n+"px",r.height=a+"px",i.style.position="absolute",this.borderRadius>0&&(i.style.borderRadius=this.borderRadius+"px"),i.style.pointerEvents="initial",document.body.append(i),this.cssRenderer=new Hi,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new Di;const c=new qi(i);c.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/e),pt(c,Et(this.gameObject)),ce(c,pe(this.gameObject)),c.quaternion.multiply(this.rotate90),this.cssScene.add(c),this.cssObj=c,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;pt(this.cssObj,Et(this.gameObject)),ce(this.cssObj,pe(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const t=this.context.mainCamera,i=this.gameObject;var r=t.position.clone().sub(this.gameObject.position).normalize(),e=i.getWorldDirection(new O);const n=r.dot(e);this.cssObj.visible=n<.15;const a=this.cssRenderer.getSize();(a.width!==this.context.domWidth||a.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}vt([u()],k.prototype,"url",2);vt([u()],k.prototype,"pixelsPerUnit",2);vt([u()],k.prototype,"borderRadius",2);vt([u(Gt)],k.prototype,"animator",2);class Dr extends l{constructor(){super(...arguments),this._ui=null,this._incubationsHint=null,this._components=[]}onEnable(){var e;(e=this._ui)==null||e.remove(),this._components=m.findObjectsOfType(hi);const t=document.createElement("div");t.style.cssText=`
            font-family: 'Roboto flex', Ariel;
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(t),this._ui=t;const i=document.createElement("h2");i.style.cssText=`
            margin-bottom: .7em;
        `,i.innerText="Sample Images",t.appendChild(i);const r=document.createElement("p");r.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,r.style.userSelect="all",t.appendChild(r);for(const n of this._components)this.createDownloadImageUI(n,t)}onDisable(){var t;(t=this._ui)==null||t.remove()}update(){var t;this.context.isInAR?(t=this._ui)==null||t.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}onUpdateXR(t){if(t.xr.frame&&!("getImageTrackingResults"in t.xr.frame)&&!this._incubationsHint&&this._ui&&x.isAndroidDevice()){const i=document.createElement("p");i.style.cssText=`
                    background: rgba(255, 100, 100, .7);
                    border-radius: .5rem;
                    padding: .4rem;
                `,i.innerText="WebXR ImageTracking is not enabled. Go to chrome://flags/#webxr-incubations and enable #webxr-incubations",this._ui.append(i),this._incubationsHint=i}}createDownloadImageUI(t,i){if(t.trackedImages)for(const r of t.trackedImages){if(!r.image)continue;const e=document.createElement("a");e.href=r.image,e.target="_blank",i.appendChild(e);const n=document.createElement("img");n.src=r.image,n.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,e.appendChild(n)}}}var Tr=Object.defineProperty,Er=Object.getOwnPropertyDescriptor,Ie=(s,t,i,r)=>{for(var e=r>1?void 0:r?Er(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Tr(t,i,e),e};class Bt extends l{constructor(){super(...arguments),this.tempVec1=new O,this.tempVec2=new O}update(){if(!this.lodGroup||!this.text)return;const t=this.context.mainCamera;t.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const i=this.tempVec1.distanceTo(this.tempVec2)/t.zoom,r=this.lodGroup._lodsHandler;let e=null;r==null||r.forEach(n=>{var d,g;const a=n.levels[n.getCurrentLevel()],c=n.levels.at(n.getCurrentLevel()+1);let p=null;if(a.object instanceof Ti){const S=a.object.geometry.attributes,F=Math.floor(((d=S.position)==null?void 0:d.count)||0);p=`Triangles: ${Math.floor((((g=S.index)==null?void 0:g.count)||F)/3)}, Vertices: ${F}`}a.object.name.replace(/_/g,""),a.object.name.includes("Cull")||(e="",p&&(e+=`${p}
`),c==null||c.hysteresis,e+=`${a.distance.toFixed(1)} / ${i.toFixed(1)}`,c&&(e+=` / ${(c.distance-c.distance*c.hysteresis).toFixed(1)}`))}),e||(e="culled"),this.text.text=e}}Ie([o(ci)],Bt.prototype,"lodGroup",2);Ie([o(Y)],Bt.prototype,"text",2);var Mr=Object.defineProperty,$r=Object.getOwnPropertyDescriptor,Xt=(s,t,i,r)=>{for(var e=r>1?void 0:r?$r(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Mr(t,i,e),e};class At extends l{onColorChanged(){typeof this.color=="number"&&(this.color=new dt(this.color)),this.setColorToMaterials()}onPointerClick(t){const i=new dt(Math.random(),Math.random(),Math.random());this.color=i}onEnable(){f("<strong>Click an object</strong> to change the color. Open this window in another browser tab/window to see the networking in action..."),this.setColorToMaterials()}setColorToMaterials(){var i;const t=this.gameObject.getComponent(y);if(t)for(let r=0;r<t.sharedMaterials.length;r++){const e=(i=t.sharedMaterials[r])==null?void 0:i.clone();t.sharedMaterials[r]=e,e&&"color"in e&&(e.color=this.color)}else console.warn("No renderer found",this.gameObject)}}Xt([z(At.prototype.onColorChanged),o(dt)],At.prototype,"color",2);class It extends l{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const t=new Date().toLocaleTimeString();console.log("> Update array",t),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(t),this.myArray=this.myArray,f(`<strong>> Send</strong> "${t}", ${this.myArray.length} elements`)}}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),f(`<strong>< Received</strong> "${this.myArray[this.myArray.length-1]}", we now have ${this.myArray.length} elements`)}start(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateArray,4e3)}}Xt([z(It.prototype.onArrayChanged)],It.prototype,"myArray",2);class Ar{constructor(){this.name="",this.age=0}}class Lt extends l{constructor(){super(...arguments),this.myObject=new Ar,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this.myObject.age+=1,this.myObject=this.myObject,console.log("> Updated",this.myObject),f('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}onObjectChanged(){console.log("< Received object",this.myObject),f(`<strong>< Received</strong> "${this.myObject.name}" is ${this.myObject.age} years old`)}awake(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateObject,5e3)}}Xt([z(Lt.prototype.onObjectChanged)],Lt.prototype,"myObject",2);var Ir=Object.defineProperty,Lr=Object.getOwnPropertyDescriptor,Le=(s,t,i,r)=>{for(var e=r>1?void 0:r?Lr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Ir(t,i,e),e};class Jt extends l{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const t=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=t,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(t){this.maxFrameRate=t,this.clampFrameRate=!0}setClamping(t){this.clampFrameRate=t}}Le([o()],Jt.prototype,"clampFrameRate",2);Le([o()],Jt.prototype,"maxFrameRate",2);var Fr=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,wt=(s,t,i,r)=>{for(var e=r>1?void 0:r?Nr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Fr(t,i,e),e};class B extends l{constructor(){super(...arguments),this.width=1024,this.height=1024,this.prefab=null}takePhoto(){const t=pi({type:"texture",camera:this.camera,width:this.width,height:this.height});this.prefab&&t instanceof Ei&&this.prefab.instantiate(this.scene).then(i=>{if(!i)return;setTimeout(()=>{i.destroy()},2e3),i==null||i.position.set(0,3,0),i==null||i.getOrAddComponent(di);const r=i==null?void 0:i.getComponentInChildren(D);r&&(r.teleport(this.gameObject.worldPosition.add({x:0,y:.5,z:0})),r.setAngularVelocity(Math.random()-.5,Math.random()-.5,Math.random()*2-1),r.applyImpulse(this.gameObject.worldForward.add({x:0,y:2,z:0}).normalize().multiplyScalar(.01)));const e=i==null?void 0:i.getComponentInChildren(y);if(e){const n=e.sharedMaterial.clone()||new ye;n&&"map"in n&&(n.map=t,n.side=Mi),e.sharedMaterial=n}})}}wt([o(be)],B.prototype,"camera",2);wt([o()],B.prototype,"width",2);wt([o()],B.prototype,"height",2);wt([o(xe)],B.prototype,"prefab",2);var zr=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,I=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ur(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&zr(t,i,e),e};class X extends l{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(t){var i;this.logEvents&&console.log("ENTER",t),(i=this.onEnter)==null||i.invoke(t)}onCollisionStay(t){var i;this.logEvents&&console.log("STAY",t),(i=this.onStay)==null||i.invoke(t)}onCollisionExit(t){var i;this.logEvents&&console.log("EXIT",t),(i=this.onExit)==null||i.invoke(t)}}I([u(b)],X.prototype,"onEnter",2);I([u(b)],X.prototype,"onStay",2);I([u(b)],X.prototype,"onExit",2);I([u()],X.prototype,"logEvents",2);class J extends l{onTriggerEnter(t){var i,r;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(r=this.onEnter)==null||r.invoke()}onTriggerStay(t){var i,r;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(r=this.onStay)==null||r.invoke()}onTriggerExit(t){var i,r;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(r=this.onExit)==null||r.invoke()}}I([u(m)],J.prototype,"triggerObjects",2);I([u(b)],J.prototype,"onEnter",2);I([u(b)],J.prototype,"onStay",2);I([u(b)],J.prototype,"onExit",2);var Vr=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,Gr=(s,t,i,r)=>{for(var e=r>1?void 0:r?Wr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Vr(t,i,e),e};class Fe extends l{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(t){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}Gr([u(mt)],Fe.prototype,"animation",2);var Rr=Object.defineProperty,Hr=Object.getOwnPropertyDescriptor,qr=(s,t,i,r)=>{for(var e=r>1?void 0:r?Hr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Rr(t,i,e),e};class Ne extends l{onTriggerEnter(){var t,i;(t=this.animation)!=null&&t.isPlaying||(i=this.animation)==null||i.play(0,{loop:!1})}}qr([u(mt)],Ne.prototype,"animation",2);var Kr=Object.defineProperty,Qr=Object.getOwnPropertyDescriptor,Yr=(s,t,i,r)=>{for(var e=r>1?void 0:r?Qr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Kr(t,i,e),e};class ze extends l{onCollisionEnter(){var t,i;(t=this.audioSource)==null||t.stop(),(i=this.audioSource)==null||i.play()}}Yr([u(N)],ze.prototype,"audioSource",2);class Zr extends l{onEnable(){const t=m.findObjectOfType(Rt);t==null||t.addEventListener("before-export",()=>{this.resetAnimations()})}onEnterXR(t){this.resetAnimations()}resetAnimations(){console.warn("Resetting animations and audio for XR export.");const t=m.findObjectsOfType(mt);for(const r of t)r.actions.forEach(e=>{e.reset(),e.time=0,e.play()});const i=m.findObjectsOfType(N);for(const r of i)r.stop(),r.play()}}var kr=Object.defineProperty,Br=Object.getOwnPropertyDescriptor,Ue=(s,t,i,r)=>{for(var e=r>1?void 0:r?Br(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&kr(t,i,e),e};class te extends l{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const t=this.context.domWidth/this.referenceSize;this.content.scale.set(t,t,t)}else Q()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}Ue([o(C)],te.prototype,"content",2);Ue([o()],te.prototype,"referenceSize",2);var Xr=Object.defineProperty,Jr=Object.getOwnPropertyDescriptor,ee=(s,t,i,r)=>{for(var e=r>1?void 0:r?Jr(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Xr(t,i,e),e};class Ve extends l{async sceneOpened(){var t;(t=this.animator)==null||t.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var t,i;await Mt(1e3),(t=this.animator)==null||t.setBool("SceneOpen",!1),await Mt(1e3),(i=this._htmlElement)==null||i.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const t=document.createElement("img");t.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(t)}return this._htmlElement}}ee([o(Gt)],Ve.prototype,"animator",2);class ie extends l{sceneOpened(){var t;return Q()&&console.log("Scene opened",this.name),(t=this.opened)==null||t.invoke(),Promise.resolve()}sceneClosing(){var t;return Q()&&console.log("Scene closing",this.name),(t=this.closing)==null||t.invoke(),Promise.resolve()}}ee([o(b)],ie.prototype,"opened",2);ee([o(b)],ie.prototype,"closing",2);class ts extends l{next(){var t;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(t=this.switcher)==null||t.selectNext()}previous(){var t;this.switcher??(this.switcher=this.get()),(t=this.switcher)==null||t.selectPrev()}get(){return m.findObjectOfType(mi)}}class es extends l{awake(){const t=this.gameObject.getComponent(y);if(t!=null&&t.sharedMaterials)for(const i of t.sharedMaterials)i&&(i.side=$i)}}var is=Object.defineProperty,rs=Object.getOwnPropertyDescriptor,ss=(s,t,i,r)=>{for(var e=r>1?void 0:r?rs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&is(t,i,e),e};class We extends l{constructor(){super(...arguments),this.text=""}start(){f(this.text)}}ss([o()],We.prototype,"text",2);var ns=Object.defineProperty,as=Object.getOwnPropertyDescriptor,os=(s,t,i,r)=>{for(var e=r>1?void 0:r?as(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&ns(t,i,e),e};const ls=P("testleaderboard");class Ft extends l{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(ui.JoinedRoom,async()=>{await Mt(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),ls?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):Q()&&f("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(t,i){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const r=10,e=this.data.scores;for(;e.length>=r;){this.sortScores();const n=e.pop();if(n.score>i){console.log(`Score ${i} is lower than ${n==null?void 0:n.score} (lowest score), ignoring`),e.push(n);return}}console.log("Inserting score",t,i),e.push({name:t,score:i}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((t,i)=>i.score-t.score)}onDataChanged(t){if(console.warn("Data changed!",t,this.data.scores),this.data.scores.length>0){const i=this.data.scores[0];f("HIGHSCORE - "+i.name+": "+i.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}os([z(Ft.prototype.onDataChanged)],Ft.prototype,"data",2);var hs=Object.defineProperty,cs=Object.getOwnPropertyDescriptor,ps=(s,t,i,r)=>{for(var e=r>1?void 0:r?cs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&hs(t,i,e),e};class Ge extends l{start(){this.updateStartPosition();const t=m.findObjectOfType(Rt);t&&t.addEventListener("before-export",()=>{this.resetToStart()})}updateStartPosition(){this.gameObject.updateMatrix(),this.startPosition=this.gameObject.position.clone(),this.startMatrix=this.gameObject.matrix.clone()}resetToStart(){if(!this.startPosition)return;const t=m.getComponent(this.gameObject,D);t==null||t.teleport(this.startPosition)}}class Re extends Ge{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(t){t===this.worldCollider&&this.resetToStart()}createBehaviours(t,i,r){if(i.uuid!==this.gameObject.uuid||!this.startPosition||!this.startMatrix)return;const e=ht.createEmpty();this.gameObject.parent?e.matrix=this.gameObject.parent.matrixWorld.clone().multiply(this.startMatrix):e.matrix=this.startMatrix,r.document.add(e);const n=new $("_reset_"+this.name+"_afterTime",A.sceneStartTrigger(),_.sequence(_.waitAction(Math.random()*4+1),_.sequence(_.transformAction(this.gameObject,e,0,"absolute","none"),_.waitAction(5)).makeLooping())).makeExclusive(!0);t.addBehavior(n)}}ps([u(ut)],Re.prototype,"worldCollider",2);var ds=Object.defineProperty,ms=Object.getOwnPropertyDescriptor,us=(s,t,i,r)=>{for(var e=r>1?void 0:r?ms(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&ds(t,i,e),e};class He extends l{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const t=this.context.connection;let i=!1;t.currentRoomName&&t.currentRoomName!==this.roomId&&(this.roomId=t.currentRoomName,i=!0),t.usersInRoom().length!==this.playerCount&&(this.playerCount=t.usersInRoom().length,i=!0),i&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${t.connectionId}`)}}us([o(Y)],He.prototype,"connectionLabel",2);var fs=Object.defineProperty,gs=Object.getOwnPropertyDescriptor,bs=(s,t,i,r)=>{for(var e=r>1?void 0:r?gs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&fs(t,i,e),e};class qe extends l{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),f("TimedSpawn: no object to spawn",ve.Warn);return}m.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const t=m.instantiate(this.object);m.setActive(t,!0),this.spawned+=1,yield fi(this.interval/1e3)}}}bs([u(m)],qe.prototype,"object",2);var xs=Object.defineProperty,vs=Object.getOwnPropertyDescriptor,ws=(s,t,i,r)=>{for(var e=r>1?void 0:r?vs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&xs(t,i,e),e};class Ke extends l{constructor(){super(...arguments),this.onlyMobile=!1}awake(){if(this.onlyMobile&&!gi())return;const t=this.gameObject.getComponent(bi);t&&(t.position="top")}}ws([o()],Ke.prototype,"onlyMobile",2);class _s extends l{constructor(){super(...arguments),this._video=null}async onEnable(){this._video??(this._video=document.createElement("video")),this._video.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            object-fit: cover;
        `,this.context.domElement.shadowRoot.appendChild(this._video);const t=await navigator.mediaDevices.getUserMedia({video:!0});!t||!this.enabled||(this._video.srcObject=t,this._video.play())}onDisable(){var t,i;(t=this._video)==null||t.pause(),(i=this._video)==null||i.remove()}}var Os=Object.defineProperty,ys=Object.getOwnPropertyDescriptor,_t=(s,t,i,r)=>{for(var e=r>1?void 0:r?ys(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Os(t,i,e),e};class tt extends l{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const t=this.gameObject.position.clone(),i=this.gameObject.rotation.clone(),r=this.gameObject.getComponent(D),e=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(t),this.resetRotation&&this.gameObject.rotation.copy(i),r&&this.resetVelocity&&this.context.time.frame!==e&&r.resetVelocities()},this.interval*1e3)}}_t([o()],tt.prototype,"interval",2);_t([o()],tt.prototype,"resetPosition",2);_t([o()],tt.prototype,"resetRotation",2);_t([o()],tt.prototype,"resetVelocity",2);class Ps extends l{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(f('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const t=this.gameObject.getComponent(y);t&&(t.enabled=!t.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var Cs=Object.defineProperty,js=Object.getOwnPropertyDescriptor,Ss=(s,t,i,r)=>{for(var e=r>1?void 0:r?js(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Cs(t,i,e),e};class Qe extends l{awake(){this.material&&(this.material.wireframe=!0)}}Ss([o(Pe)],Qe.prototype,"material",2);var Ds=Object.defineProperty,Ts=Object.getOwnPropertyDescriptor,Ye=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ts(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Ds(t,i,e),e};class re extends l{constructor(){super(...arguments),this.onSessionStart=new b,this.onSessionEnd=new b}onEnterXR(t){this.onWebXRStarted()}onExitXR(t){this.onWebXREnded()}onWebXRStarted(){this.onSessionStart.invoke()}onWebXREnded(){this.onSessionEnd.invoke()}}Ye([o(b)],re.prototype,"onSessionStart",2);Ye([o(b)],re.prototype,"onSessionEnd",2);const lt=P("debugbodytracking");class Es extends l{constructor(){super(...arguments),this.jointPositions=new Map,this.size=new O(.01,.01,.01),this.hasWarnedForName=new Set}onEnable(){lt&&console.log(fe.join(`
`))}onBeforeXR(t,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("body-tracking")||i.optionalFeatures.push("body-tracking")}onUpdateXR(t){const i=t.xr.frame;if(!i)return;const r=t.xr.rig.gameObject,e=this.context.renderer.xr.getReferenceSpace();if(i.session&&"body"in i&&e){const n=i.body;if(!n)return;n.forEach(a=>{const c=i.getPose(a,e);if(!c)return;const p=c.transform.position,d=v();d.copy(p),d.x*=-1,d.z*=-1,r.localToWorld(d);const g=a.jointName;this.jointPositions.has(g)||this.jointPositions.set(g,new O),this.jointPositions.get(g).copy(d),lt&&M.DrawWireBox(d,this.size,16711680,void 0,!1);const S=v();S.copy(p),S.x*=-1,r.localToWorld(S);const F=a.jointName+"-flipped";this.jointPositions.has(F)||this.jointPositions.set(F,new O),this.jointPositions.get(F).copy(S),lt&&M.DrawWireBox(S,this.size,65280,void 0,!1);const ot=fe.indexOf(g);lt&&M.DrawLabel(S,ot.toString(),.015,void 0,16777215,85),ot<0&&(this.hasWarnedForName.has(g)||(this.hasWarnedForName.add(g),console.warn("Wrong name: "+g+" -> "+ot+". Please report a bug.")))});for(const a of Ms){const c=this.jointPositions.get(a.from),p=this.jointPositions.get(a.to);if(c&&p){M.DrawLine(c,p,16776960,void 0,!1);const d=this.jointPositions.get(a.from+"-flipped"),g=this.jointPositions.get(a.to+"-flipped");d&&g&&M.DrawLine(d,g,65535,void 0,!1)}}}}}var Ze=(s=>(s[s.root=0]="root",s[s.hips=1]="hips",s[s["spine-lower"]=2]="spine-lower",s[s["spine-middle"]=3]="spine-middle",s[s["spine-upper"]=4]="spine-upper",s[s.chest=5]="chest",s[s.neck=6]="neck",s[s.head=7]="head",s[s["left-shoulder"]=8]="left-shoulder",s[s["left-scapula"]=9]="left-scapula",s[s["left-arm-upper"]=10]="left-arm-upper",s[s["left-arm-lower"]=11]="left-arm-lower",s[s["left-hand-wrist-twist"]=12]="left-hand-wrist-twist",s[s["right-shoulder"]=13]="right-shoulder",s[s["right-scapula"]=14]="right-scapula",s[s["right-arm-upper"]=15]="right-arm-upper",s[s["right-arm-lower"]=16]="right-arm-lower",s[s["right-hand-wrist-twist"]=17]="right-hand-wrist-twist",s[s["left-hand-palm"]=18]="left-hand-palm",s[s["left-hand-wrist"]=19]="left-hand-wrist",s[s["left-hand-thumb-metacarpal"]=20]="left-hand-thumb-metacarpal",s[s["left-hand-thumb-phalanx-proximal"]=21]="left-hand-thumb-phalanx-proximal",s[s["left-hand-thumb-phalanx-distal"]=22]="left-hand-thumb-phalanx-distal",s[s["left-hand-thumb-tip"]=23]="left-hand-thumb-tip",s[s["left-hand-index-metacarpal"]=24]="left-hand-index-metacarpal",s[s["left-hand-index-phalanx-proximal"]=25]="left-hand-index-phalanx-proximal",s[s["left-hand-index-phalanx-intermediate"]=26]="left-hand-index-phalanx-intermediate",s[s["left-hand-index-phalanx-distal"]=27]="left-hand-index-phalanx-distal",s[s["left-hand-index-tip"]=28]="left-hand-index-tip",s[s["left-hand-middle-phalanx-metacarpal"]=29]="left-hand-middle-phalanx-metacarpal",s[s["left-hand-middle-phalanx-proximal"]=30]="left-hand-middle-phalanx-proximal",s[s["left-hand-middle-phalanx-intermediate"]=31]="left-hand-middle-phalanx-intermediate",s[s["left-hand-middle-phalanx-distal"]=32]="left-hand-middle-phalanx-distal",s[s["left-hand-middle-tip"]=33]="left-hand-middle-tip",s[s["left-hand-ring-metacarpal"]=34]="left-hand-ring-metacarpal",s[s["left-hand-ring-phalanx-proximal"]=35]="left-hand-ring-phalanx-proximal",s[s["left-hand-ring-phalanx-intermediate"]=36]="left-hand-ring-phalanx-intermediate",s[s["left-hand-ring-phalanx-distal"]=37]="left-hand-ring-phalanx-distal",s[s["left-hand-ring-tip"]=38]="left-hand-ring-tip",s[s["left-hand-little-metacarpal"]=39]="left-hand-little-metacarpal",s[s["left-hand-little-phalanx-proximal"]=40]="left-hand-little-phalanx-proximal",s[s["left-hand-little-phalanx-intermediate"]=41]="left-hand-little-phalanx-intermediate",s[s["left-hand-little-phalanx-distal"]=42]="left-hand-little-phalanx-distal",s[s["left-hand-little-tip"]=43]="left-hand-little-tip",s[s["right-hand-palm"]=44]="right-hand-palm",s[s["right-hand-wrist"]=45]="right-hand-wrist",s[s["right-hand-thumb-metacarpal"]=46]="right-hand-thumb-metacarpal",s[s["right-hand-thumb-phalanx-proximal"]=47]="right-hand-thumb-phalanx-proximal",s[s["right-hand-thumb-phalanx-distal"]=48]="right-hand-thumb-phalanx-distal",s[s["right-hand-thumb-tip"]=49]="right-hand-thumb-tip",s[s["right-hand-index-metacarpal"]=50]="right-hand-index-metacarpal",s[s["right-hand-index-phalanx-proximal"]=51]="right-hand-index-phalanx-proximal",s[s["right-hand-index-phalanx-intermediate"]=52]="right-hand-index-phalanx-intermediate",s[s["right-hand-index-phalanx-distal"]=53]="right-hand-index-phalanx-distal",s[s["right-hand-index-tip"]=54]="right-hand-index-tip",s[s["right-hand-middle-metacarpal"]=55]="right-hand-middle-metacarpal",s[s["right-hand-middle-phalanx-proximal"]=56]="right-hand-middle-phalanx-proximal",s[s["right-hand-middle-phalanx-intermediate"]=57]="right-hand-middle-phalanx-intermediate",s[s["right-hand-middle-phalanx-distal"]=58]="right-hand-middle-phalanx-distal",s[s["right-hand-middle-tip"]=59]="right-hand-middle-tip",s[s["right-hand-ring-metacarpal"]=60]="right-hand-ring-metacarpal",s[s["right-hand-ring-phalanx-proximal"]=61]="right-hand-ring-phalanx-proximal",s[s["right-hand-ring-phalanx-intermediate"]=62]="right-hand-ring-phalanx-intermediate",s[s["right-hand-ring-phalanx-distal"]=63]="right-hand-ring-phalanx-distal",s[s["right-hand-ring-tip"]=64]="right-hand-ring-tip",s[s["right-hand-little-metacarpal"]=65]="right-hand-little-metacarpal",s[s["right-hand-little-phalanx-proximal"]=66]="right-hand-little-phalanx-proximal",s[s["right-hand-little-phalanx-intermediate"]=67]="right-hand-little-phalanx-intermediate",s[s["right-hand-little-phalanx-distal"]=68]="right-hand-little-phalanx-distal",s[s["right-hand-little-tip"]=69]="right-hand-little-tip",s[s["left-upper-leg"]=70]="left-upper-leg",s[s["left-lower-leg"]=71]="left-lower-leg",s[s["left-foot-ankle-twist"]=72]="left-foot-ankle-twist",s[s["left-foot-ankle"]=73]="left-foot-ankle",s[s["left-foot-subtalar"]=74]="left-foot-subtalar",s[s["left-foot-transverse"]=75]="left-foot-transverse",s[s["left-foot-ball"]=76]="left-foot-ball",s[s["right-upper-leg"]=77]="right-upper-leg",s[s["right-lower-leg"]=78]="right-lower-leg",s[s["right-foot-ankle-twist"]=79]="right-foot-ankle-twist",s[s["right-foot-ankle"]=80]="right-foot-ankle",s[s["right-foot-subtalar"]=81]="right-foot-subtalar",s[s["right-foot-transverse"]=82]="right-foot-transverse",s[s["right-foot-ball"]=83]="right-foot-ball",s))(Ze||{});const fe=Object.values(Ze),Ms=[{from:"hips",to:"spine-lower"},{from:"spine-lower",to:"spine-middle"},{from:"spine-middle",to:"spine-upper"},{from:"spine-upper",to:"chest"},{from:"chest",to:"neck"},{from:"neck",to:"head"},{from:"chest",to:"left-shoulder"},{from:"left-shoulder",to:"left-scapula"},{from:"left-scapula",to:"left-arm-upper"},{from:"left-arm-upper",to:"left-arm-lower"},{from:"left-arm-lower",to:"left-hand-wrist-twist"},{from:"left-hand-wrist-twist",to:"left-hand-wrist"},{from:"left-hand-wrist",to:"left-hand-palm"},{from:"left-hand-wrist",to:"left-hand-thumb-metacarpal"},{from:"left-hand-thumb-metacarpal",to:"left-hand-thumb-phalanx-proximal"},{from:"left-hand-thumb-phalanx-proximal",to:"left-hand-thumb-phalanx-distal"},{from:"left-hand-thumb-phalanx-distal",to:"left-hand-thumb-tip"},{from:"left-hand-wrist",to:"left-hand-index-metacarpal"},{from:"left-hand-index-metacarpal",to:"left-hand-index-phalanx-proximal"},{from:"left-hand-index-phalanx-proximal",to:"left-hand-index-phalanx-intermediate"},{from:"left-hand-index-phalanx-intermediate",to:"left-hand-index-phalanx-distal"},{from:"left-hand-index-phalanx-distal",to:"left-hand-index-tip"},{from:"left-hand-wrist",to:"left-hand-middle-phalanx-metacarpal"},{from:"left-hand-middle-phalanx-metacarpal",to:"left-hand-middle-phalanx-proximal"},{from:"left-hand-middle-phalanx-proximal",to:"left-hand-middle-phalanx-intermediate"},{from:"left-hand-middle-phalanx-intermediate",to:"left-hand-middle-phalanx-distal"},{from:"left-hand-middle-phalanx-distal",to:"left-hand-middle-tip"},{from:"left-hand-wrist",to:"left-hand-ring-metacarpal"},{from:"left-hand-ring-metacarpal",to:"left-hand-ring-phalanx-proximal"},{from:"left-hand-ring-phalanx-proximal",to:"left-hand-ring-phalanx-intermediate"},{from:"left-hand-ring-phalanx-intermediate",to:"left-hand-ring-phalanx-distal"},{from:"left-hand-ring-phalanx-distal",to:"left-hand-ring-tip"},{from:"left-hand-wrist",to:"left-hand-little-metacarpal"},{from:"left-hand-little-metacarpal",to:"left-hand-little-phalanx-proximal"},{from:"left-hand-little-phalanx-proximal",to:"left-hand-little-phalanx-intermediate"},{from:"left-hand-little-phalanx-intermediate",to:"left-hand-little-phalanx-distal"},{from:"left-hand-little-phalanx-distal",to:"left-hand-little-tip"},{from:"chest",to:"right-shoulder"},{from:"right-shoulder",to:"right-scapula"},{from:"right-scapula",to:"right-arm-upper"},{from:"right-arm-upper",to:"right-arm-lower"},{from:"right-arm-lower",to:"right-hand-wrist-twist"},{from:"right-hand-wrist-twist",to:"right-hand-wrist"},{from:"right-hand-wrist",to:"right-hand-palm"},{from:"right-hand-wrist",to:"right-hand-thumb-metacarpal"},{from:"right-hand-thumb-metacarpal",to:"right-hand-thumb-phalanx-proximal"},{from:"right-hand-thumb-phalanx-proximal",to:"right-hand-thumb-phalanx-distal"},{from:"right-hand-thumb-phalanx-distal",to:"right-hand-thumb-tip"},{from:"right-hand-wrist",to:"right-hand-index-metacarpal"},{from:"right-hand-index-metacarpal",to:"right-hand-index-phalanx-proximal"},{from:"right-hand-index-phalanx-proximal",to:"right-hand-index-phalanx-intermediate"},{from:"right-hand-index-phalanx-intermediate",to:"right-hand-index-phalanx-distal"},{from:"right-hand-index-phalanx-distal",to:"right-hand-index-tip"},{from:"right-hand-wrist",to:"right-hand-middle-metacarpal"},{from:"right-hand-middle-metacarpal",to:"right-hand-middle-phalanx-proximal"},{from:"right-hand-middle-phalanx-proximal",to:"right-hand-middle-phalanx-intermediate"},{from:"right-hand-middle-phalanx-intermediate",to:"right-hand-middle-phalanx-distal"},{from:"right-hand-middle-phalanx-distal",to:"right-hand-middle-tip"},{from:"right-hand-wrist",to:"right-hand-ring-metacarpal"},{from:"right-hand-ring-metacarpal",to:"right-hand-ring-phalanx-proximal"},{from:"right-hand-ring-phalanx-proximal",to:"right-hand-ring-phalanx-intermediate"},{from:"right-hand-ring-phalanx-intermediate",to:"right-hand-ring-phalanx-distal"},{from:"right-hand-ring-phalanx-distal",to:"right-hand-ring-tip"},{from:"right-hand-wrist",to:"right-hand-little-metacarpal"},{from:"right-hand-little-metacarpal",to:"right-hand-little-phalanx-proximal"},{from:"right-hand-little-phalanx-proximal",to:"right-hand-little-phalanx-intermediate"},{from:"right-hand-little-phalanx-intermediate",to:"right-hand-little-phalanx-distal"},{from:"right-hand-little-phalanx-distal",to:"right-hand-little-tip"},{from:"hips",to:"left-upper-leg"},{from:"left-upper-leg",to:"left-lower-leg"},{from:"left-lower-leg",to:"left-foot-ankle-twist"},{from:"left-foot-ankle-twist",to:"left-foot-ankle"},{from:"left-foot-ankle",to:"left-foot-subtalar"},{from:"left-foot-subtalar",to:"left-foot-transverse"},{from:"left-foot-transverse",to:"left-foot-ball"},{from:"hips",to:"right-upper-leg"},{from:"right-upper-leg",to:"right-lower-leg"},{from:"right-lower-leg",to:"right-foot-ankle-twist"},{from:"right-foot-ankle-twist",to:"right-foot-ankle"},{from:"right-foot-ankle",to:"right-foot-subtalar"},{from:"right-foot-subtalar",to:"right-foot-transverse"},{from:"right-foot-transverse",to:"right-foot-ball"}];var $s=Object.defineProperty,As=Object.getOwnPropertyDescriptor,Is=(s,t,i,r)=>{for(var e=r>1?void 0:r?As(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&$s(t,i,e),e};class se extends l{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(D)||void 0,this._rigidbody){const t=this.gameObject.getComponentsInChildren(ut);for(const i of t){const r=m.addComponent(i.gameObject,Ls);r.rigidBody=this._rigidbody,r.arrow=this,r.audioOnImpact=this.audioOnImpact,r.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const t=this._rigidbody.getVelocity();if(t.lengthSq()>0){const i=v().set(t.x,t.y,t.z).normalize(),r=xi();r.setFromUnitVectors(v(0,0,1),i),this.gameObject.quaternion.copy(r)}}}}Is([o(N)],se.prototype,"audioOnImpact",2);class Ls extends l{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(t){var i,r;if(this.arrow)if((i=this.audioOnImpact)==null||i.stop(),(r=this.audioOnImpact)==null||r.play(),this.destroyTarget)t.gameObject.destroy(),this.arrow.gameObject.destroy();else{t.gameObject.attach(this.arrow.gameObject),t.rigidBody instanceof D&&t.rigidBody.applyImpulse(t.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const e=this.rigidBody.gameObject.getComponentsInChildren(ut);for(const n of e)n.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var Fs=Object.defineProperty,Ns=Object.getOwnPropertyDescriptor,T=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ns(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Fs(t,i,e),e};const ge=P("debugarrow");class j extends l{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this._tempLookMatrix=new Ai,this._tempLookRot=new $t,this._lastShotTimestamp=Number.MIN_SAFE_INTEGER,this._isAiming=!1,this._bowController=void 0,this._stringController=void 0,this._controllerFollow=null,this._aimingPointerStartPos=new O,this._initialBowObjectRotation=new $t,this._initialBowObjectPosition=new O,this._screenDragRaycaster=new Ii,this._screenDragPlane=new Li,this._screenDragRayLine=new Fi,this.onDown=t=>{t.origin instanceof de?t.button===0&&(this._bowController===void 0?(this._bowController=t.origin.index,this.bowObject.quaternion.copy(this._initialBowObjectRotation)):this._stringController===void 0&&(this._stringController=t.origin.index),this._bowController===this._stringController&&(this._stringController=void 0),this._controllerFollow&&(this._controllerFollow.side=this._bowController,this._controllerFollow.enabled=this._bowController!==void 0),this._isAiming=this._stringController!==void 0):t.button===0&&(this._isAiming=!0,this._stringPointerId=t.pointerId,this.getScreenDragPoint(t.pointerId,this._aimingPointerStartPos))},this.onRelease=t=>{var i;if(t.button===0){if(t.origin instanceof de){const r=t.origin;if(this._isAiming&&r.index===this._stringController&&r.index!==this._bowController&&typeof this._bowController=="number"){const e=(i=ct.active)==null?void 0:i.getController(this._bowController);if(r&&e){const n=r.gripWorldPosition;if(n){const a=e.gripWorldPosition.clone().sub(n);let c=e.object.worldPosition.distanceTo(r.object.worldPosition);c-=this.drawMinPhysicalDistance;const p=w.clamp01(c/this.drawMaxPhysicalDistance)*this.power;a.normalize().multiplyScalar(p),this.shoot(n,a),ge&&M.DrawArrow(n,a.clone().add(n),16776960,1)}}}r.index===this._bowController&&(this._bowController=void 0),r.index===this._stringController&&(this._stringController=void 0),this._isAiming=this._bowController!==void 0&&this._stringController!==void 0,this._controllerFollow&&(this._controllerFollow.enabled=this._bowController!==void 0)}else{const r=this._aimingPointerStartPos,e=this.getScreenDragPoint(this._stringPointerId,v()),n=this.arrowSpawnSpot.getWorldPosition(v()),a=this.bowObject.getWorldDirection(v()).multiplyScalar(-1),c=r.distanceTo(e),p=w.clamp01(c/this.drawMaxPhysicalDistance)*this.power;a.normalize().multiplyScalar(p),this.shoot(n,a)}this._stringPointerId=void 0}}}get _hasControllers(){var t;return(((t=this.context.xr)==null?void 0:t.controllers.length)??0)>0}awake(){var t;(t=this.arrowPrefab)!=null&&t.asset&&(this.arrowPrefab.asset.visible=!1)}async onEnable(){var t;await((t=this.arrowPrefab)==null?void 0:t.loadAssetAsync()),this._isAiming=!1,this._controllerFollow=this.bowObject.getComponentInParent(wi)||null,this._initialBowObjectRotation=this.bowObject.quaternion.clone(),this._initialBowObjectPosition=this.bowObject.position.clone(),this._screenDragPlane.setFromNormalAndCoplanarPoint(v(0,1,-.2),this.bowObject.worldPosition),this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupArrowInstances()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}onLeaveXR(){this.bowObject.quaternion.copy(this._initialBowObjectRotation),this.bowObject.position.copy(this._initialBowObjectPosition)}getPointerDistanceTo(t,i){const r=this.context.input.getPointerPosition(i);return t.distanceTo(r)}async setupArrowInstances(){var i,r,e;if(!this.arrowPrefab||!this.arrowSpawnSpot||this._drawingArrow)return;const t=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});t&&(t.visible=!0,t.worldScale=v(1,1,1),this._drawingArrow=t,(i=t.getComponent(se))==null||i.destroy(),(r=t.getComponent(D))==null||r.destroy(),(e=t.getComponentInChildren(Vt))==null||e.destroy(),t.getComponentsInChildren(ut).forEach(n=>n.destroy()))}async shoot(t,i){var d,g;if(!this.arrowPrefab)return;this._lastShotTimestamp=this.context.time.time;const r=t.clone(),e=r.clone().add(i),n=Math.pow(i.length()+.5,2),a=i.clone().normalize(),c=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!c){console.error("Failed to instantiate arrow prefab, please check that objects are assigned correctly.");return}c.worldPosition=r,c.lookAt(e),c.visible=!0;const p=c.getComponent(D);p&&(p.isKinematic=!1,p.autoMass=!1,p.mass=.05,(d=this.sound)==null||d.stop(),(g=this.sound)==null||g.play(),await Ht(1),p.applyImpulse(a.multiplyScalar(n),!0))}getScreenDragPoint(t,i){const r=this.context.input.getPointerPositionRC(t);this._screenDragRaycaster.setFromCamera(r,this.context.mainCamera);const e=this._screenDragRaycaster.ray;return this._screenDragRayLine.set(e.origin,e.direction.multiplyScalar(1e5)),this._screenDragPlane.intersectLine(this._screenDragRayLine,i)||i.set(0,0,0),ge&&M.DrawWireSphere(i,.01,16711680,1),i}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new Ni(this.bowObject);const p=this.animationComponent.animations.at(0);p&&(this._animation=this._mixer.clipAction(p))}const t=.1;let i=0;const r=v(),e=v(),n=v(this.bowObject.worldUp);if(this._hasControllers){if(!this._isAiming)i=0,this._lastShotTimestamp=this.context.time.time;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const p=this.context.xr.controllers[this._stringController],d=this.context.xr.controllers[this._bowController];if(!p||!d)return;r.copy(p.gripWorldPosition),e.copy(d.gripWorldPosition)}}else this._stringPointerId!==void 0&&(e.copy(this._aimingPointerStartPos),r.copy(this.getScreenDragPoint(this._stringPointerId,v())));if(this._isAiming&&r.dot(r)>0&&e.dot(e)>0){let p=r.distanceTo(e);i=w.clamp01((p-this.drawMinPhysicalDistance)/this.drawMaxPhysicalDistance),p>.025&&(this._tempLookMatrix.lookAt(r,e,n),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot)}this.drawProgression&&(i=this.drawProgression.evaluate(i)),!this._isAiming&&!this._hasControllers&&(i=.25),this._animation.timeScale=0;const a=w.lerp(this._animation.time,i,this.context.time.deltaTime/t),c=this._animation.time;if(this._animation.time=a,Math.abs(a-c)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this._drawingArrow){let d=(this.context.time.time-this._lastShotTimestamp)/.3;d=this.easeInOutSine(w.clamp01(d)),this._drawingArrow.worldScale=v(1,1,1).multiplyScalar(d)}}easeInOutSine(t){return w.clamp01(-.5*(Math.cos(Math.PI*t)-1))}}T([o(C)],j.prototype,"bowObject",2);T([o(mt)],j.prototype,"animationComponent",2);T([o(xe)],j.prototype,"arrowPrefab",2);T([o(C)],j.prototype,"arrowSpawnSpot",2);T([o()],j.prototype,"power",2);T([o(vi)],j.prototype,"drawProgression",2);T([o()],j.prototype,"drawMaxPhysicalDistance",2);T([o()],j.prototype,"drawMinPhysicalDistance",2);T([o(N)],j.prototype,"sound",2);var zs=Object.defineProperty,Us=Object.getOwnPropertyDescriptor,Vs=(s,t,i,r)=>{for(var e=r>1?void 0:r?Us(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&zs(t,i,e),e};class ke extends l{start(){this._meshRenderer=this.gameObject.getComponentInChildren(_i)}onDestroy(){if(this.gameObject.visible&&this.particleSystem){if(this.particleSystem.shape.shapeType===Dt.MeshRenderer&&this._meshRenderer&&!we(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=Dt.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=Dt.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}Vs([o(Vt)],ke.prototype,"particleSystem",2);var Ws=Object.defineProperty,Gs=Object.getOwnPropertyDescriptor,Rs=(s,t,i,r)=>{for(var e=r>1?void 0:r?Gs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Ws(t,i,e),e};class Be extends l{constructor(){super(...arguments),this._instances=new Array}awake(){var t,i;if(!((t=this.prefabs)!=null&&t.length)||((i=this.prefabs)==null?void 0:i.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(r=>r.visible=!1)}update(){var i;if(!((i=this.prefabs)!=null&&i.length))return;const t=v();for(let r=this._instances.length-1;r>=0;r--){const e=this._instances[r];we(e.instance)?this._instances.splice(r,1):(t.setScalar(e.scale),e.instance.scale.lerp(t,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const r=this.worldPosition;r.x+=Math.random()*12-6,r.y+=Math.random()*3,r.z+=Math.random()*6;const e=Math.random()*3+.5,n=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],a=Oi(n,{parent:this.scene,position:r.clone(),scale:new O(.01,.01,.01),keepWorldPosition:!0});a.visible=!0,this._instances.push({instance:a,scale:e}),setTimeout(()=>{a.destroy()},7e3),Ht(1).then(()=>{const c=a.getComponentInChildren(D);c&&(c.gravityScale=.2+Math.random()*.3,c.mass=2,c.autoMass=!1),c==null||c.setAngularVelocity(w.random(-2,2),w.random(-2,2),w.random(-2,2)),c==null||c.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}Rs([o(C)],Be.prototype,"prefabs",2);class Hs extends l{awake(){this.context.renderer.toneMapping=zi,ue.occlusion_fragment=ue.occlusion_fragment.replace("gl_FragColor *= 1.0 - occlusion;",`
float depthMm = Depth_GetCameraDepthInMeters(depthColor, depthUv, arrayIndex);

// requires also patching ShaderChunk.occlusion_pars_fragment and adding some noise function
// float noise = snoise(gl_FragCoord.xy * 0.005);
// depthMm += noise * 0.002;

float absDistance = abs(assetDepthM - depthMm);
float v = 0.0025;
absDistance = saturate(v - absDistance) / v;

gl_FragColor.rgb += vec3(absDistance * 2.0, absDistance * 2.0, absDistance * 12.0);
gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 0.0, 0.0), occlusion * 0.7);
`)}}class qs extends l{constructor(){super(...arguments),this.interval=-1,this.supportsAR=!1,this.supportsVR=!1}async onEnable(){this.log(!0),this.interval=setInterval(()=>this.log(),500),this.supportsAR=await ct.isARSupported(),this.supportsVR=await ct.isVRSupported()}onDisable(){clearInterval(this.interval)}async log(t=!1){t&&(console.log("UserAgent",window.navigator.userAgent),console.log("isMobileDevice",x.isMobileDevice()),console.log("isiOSDevice",x.isiOS()),console.log("isMozillaXR",x.isMozillaXR()),console.log("isSafari",x.isSafari()),console.log("isQuest",x.isQuest()),console.log("isMacOS",x.isMacOS()),console.log("isVisionOS",x.isVisionOS())),f("AR: "+i(this.supportsAR)+", VR: "+i(this.supportsVR)+", QuickLook: "+i(x.supportsQuickLookAR())),x.isMobileDevice()?x.isiOS()?f("iOS 🍎"):window.navigator.userAgent.indexOf("Android")>-1?f("Android 🤖"):f("Other Mobile 📱"):x.isDesktop()?f("Desktop 🖥️"):f("Other Device 🌏"),x.isMobileDevice()&&x.isiOS()&&x.isSafari()?f("Safari 🌏"):x.isMozillaXR()?f("Mozilla XR 🦊"):x.isQuest()?f("Quest 🎮"):window.navigator.userAgent.indexOf("Chrome")>-1?f("Chrome 🌏"):f("Other Browser 🌏"),f("UserAgent: "+window.navigator.userAgent);function i(r){return r?"✅":"❌"}}}class Ks extends l{onEnable(){const t=m.findObjectOfType(Rt);t&&(t.anchoringType="plane",t.planeAnchoringAlignment="vertical")}}var Qs=Object.defineProperty,Ys=Object.getOwnPropertyDescriptor,et=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ys(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Qs(t,i,e),e};class U extends l{constructor(){super(...arguments),this.distance=.5,this.fadeDuration=1,this.targetState=!0,this.hideOnStart=!0,this.tempVector=new O}start(){this.hideOnStart&&!x.isiOS()&&this.target.scale.set(0,0,0)}update(){this.tempVector.copy(this.context.mainCameraComponent.worldPosition),this.tempVector.sub(this.worldPosition).length()<this.distance&&(this.enabled=!1)}createBehaviours(t,i,r){if(i.uuid===this.gameObject.uuid){const e=this.target?this.target:this.gameObject;this.hideOnStart&&t.addBehavior(new $("SetActiveOnProximity_active_"+this.gameObject.name,A.sceneStartTrigger(),_.fadeAction(e,0,!this.targetState))),t.addBehavior(new $("SetActiveOnProximity_"+this.gameObject.name,A.proximityToCameraTrigger(this.gameObject,this.distance),_.fadeAction(e,this.fadeDuration,this.targetState)))}}}et([o(m)],U.prototype,"target",2);et([o()],U.prototype,"distance",2);et([o()],U.prototype,"fadeDuration",2);et([o()],U.prototype,"targetState",2);et([o()],U.prototype,"hideOnStart",2);var Zs=Object.defineProperty,ks=Object.getOwnPropertyDescriptor,ne=(s,t,i,r)=>{for(var e=r>1?void 0:r?ks(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Zs(t,i,e),e};class Ot extends l{constructor(){super(...arguments),this.getCloseClip="",this.distance=.5,this.lastDistance=void 0}update(){const t=this.gameObject.worldPosition.distanceTo(this.context.mainCameraComponent.worldPosition);this.lastDistance!==void 0&&t<this.distance&&this.lastDistance>=this.distance&&this.target.play(this.getCloseClip),this.lastDistance=t}createBehaviours(t,i,r){if(i.uuid===this.gameObject.uuid){const e=this.target?this.target.gameObject:this.gameObject,n=r.extensions.find(p=>p instanceof yi);if(!n){console.warn("No AnimationExtension found",r.extensions);return}let a;const c=me.getAndRegisterAnimationSequences(n,e,this.getCloseClip);if(c)a=me.getActionForSequences(e,c.animationSequence,c.animationLoopAfterSequence,c.randomTimeOffset);else{console.warn("No animation sequence found for "+this.getCloseClip,c);return}t.addBehavior(new $("PlayAnimationOnProximity_"+this.gameObject.name,A.proximityToCameraTrigger(this.gameObject,this.distance),a));return}}}ne([o(Gt)],Ot.prototype,"target",2);ne([o()],Ot.prototype,"getCloseClip",2);ne([o()],Ot.prototype,"distance",2);var Bs=Object.defineProperty,Xs=Object.getOwnPropertyDescriptor,yt=(s,t,i,r)=>{for(var e=r>1?void 0:r?Xs(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Bs(t,i,e),e};class it extends l{constructor(){super(...arguments),this.distance=.5,this.targetState=!0}createBehaviours(t,i,r){}async afterSerialize(t,i){}}yt([o(N)],it.prototype,"target",2);yt([o(URL)],it.prototype,"clip",2);yt([o()],it.prototype,"distance",2);yt([o()],it.prototype,"targetState",2);var Js=Object.defineProperty,tn=Object.getOwnPropertyDescriptor,V=(s,t,i,r)=>{for(var e=r>1?void 0:r?tn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Js(t,i,e),e};class Pt{constructor(){this.contents=[],this.negativeContents=[],this.triggers=[]}}V([o(C)],Pt.prototype,"contents",2);V([o(C)],Pt.prototype,"negativeContents",2);V([o(C)],Pt.prototype,"triggers",2);class Ct extends l{constructor(){super(...arguments),this.elements=[],this.fadeDuration=.2,this.selectFirstOnStart=!0,this._allTargets=[],this._allTriggers=[]}get currentIndex(){return this._currentIndex}get defaultVariant(){const t=this.selectFirstOnStart?this.elements.at(0):void 0;return this._currentIndex!==void 0?this.elements.at(this._currentIndex):t}awake(){this.elements.forEach(t=>{t.contents=t.contents.filter(i=>i),t.triggers=t.triggers.filter(i=>i)}),this.elements.forEach(t=>{var i;return(i=t.contents)==null?void 0:i.forEach(r=>this._allTargets.push(r))}),this.elements.forEach(t=>{var i;return(i=t.triggers)==null?void 0:i.forEach(r=>this._allTriggers.push(r))}),this.setupForRuntime()}setupForRuntime(){this.elements.forEach((t,i)=>{var r;(r=t.triggers)==null||r.forEach(e=>{const n=Pi(e,Ut);n.onClick??(n.onClick=new b),n.onClick.addEventListener(()=>{this._currentIndex=i,this._allTargets.forEach(a=>{a.visible=t.contents.includes(a)})})})}),this.selectDefault()}selectDefault(){var i;const t=((i=this.defaultVariant)==null?void 0:i.contents)??[];this._allTargets.forEach(r=>{r.visible=t.includes(r)})}createBehaviours(t,i,r){i.uuid===this.gameObject.uuid&&this.setupForUSDZ(t)}beforeCreateDocument(t,i){this._allTargets.forEach(r=>{r.visible=!0})}async afterSerialize(t,i){await Ht(3),this.selectDefault()}setupForUSDZ(t){var e;this.elements.forEach(n=>{var a;(a=n.triggers)==null||a.forEach(c=>{const p=n.contents,d=this._cloneArray(this._allTargets).filter(g=>!p.includes(g));p.length>=0&&t.addBehavior(new $(`EnableObject_${c.uuid}`,A.tapTrigger(c),_.fadeAction(p,this.fadeDuration,!0))),d.length>=0&&t.addBehavior(new $(`DisableObject_${c.uuid}`,A.tapTrigger(c),_.fadeAction(d,this.fadeDuration,!1)))})});const i=((e=this.defaultVariant)==null?void 0:e.contents)??[],r=this._cloneArray(this._allTargets).filter(n=>!i.includes(n));t.addBehavior(new $(`HideOnStart_${this.guid}`,A.sceneStartTrigger(),_.fadeAction(r,0,!1)))}_cloneArray(t){const i=new Array(t.length);return t.forEach((r,e)=>i[e]=r),i}}V([o(Pt)],Ct.prototype,"elements",2);V([o()],Ct.prototype,"fadeDuration",2);V([o()],Ct.prototype,"selectFirstOnStart",2);var en=Object.defineProperty,rn=Object.getOwnPropertyDescriptor,E=(s,t,i,r)=>{for(var e=r>1?void 0:r?rn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&en(t,i,e),e};class W{constructor(){this.name="Name"}}E([o()],W.prototype,"name",2);E([o(ft)],W.prototype,"icon",2);E([o(b)],W.prototype,"click",2);class G{constructor(){this.title="Title",this.items=[]}}E([o()],G.prototype,"title",2);E([o(ft)],G.prototype,"icon",2);E([o(b)],G.prototype,"select",2);E([o(b)],G.prototype,"deselect",2);E([o(W)],G.prototype,"items",2);class rt extends l{constructor(){super(...arguments),this.categories=[]}awake(){document.body.insertAdjacentHTML("afterbegin",`<style>${ln}</style>`),document.body.insertAdjacentHTML("afterbegin",on),this.mainmenu=document.querySelector(".mainmenu"),this.submenuRoot=document.querySelector(".submenu-wrapper"),this.submenu=document.querySelector(".submenu"),this.submenuTitle=document.querySelector(".submenu-title"),this.submenuContent=document.querySelector(".submenu-content"),this.categories.forEach(t=>this.addCategory(t)),this.hideSubmenu()}addNewCategory(t){this.categories.push(t),this.addCategory(t)}addCategory(t){if(!this.mainmenu)return;const i=nn(t);this.mainmenu.appendChild(i),i.onclick=()=>{this.selectedCategory===t?this.hideSubmenu():this.showSubmenu(t)}}addItem(t){if(!this.submenuContent)return;const i=an(t);this.submenuContent.appendChild(i),i.onclick=()=>{var r;(r=t.click)==null||r.invoke()}}showSubmenu(t){var i,r,e,n;for(this.selectedCategory=t,(r=(i=this.selectedCategory)==null?void 0:i.select)==null||r.invoke(),this.submenuTitle&&(this.submenuTitle.textContent=t.title);(e=this.submenuContent)!=null&&e.firstChild;)this.submenuContent.removeChild(this.submenuContent.firstChild);t.items.forEach(a=>this.addItem(a)),(n=this.submenuRoot)==null||n.classList.remove("close")}hideSubmenu(){var t,i,r,e,n;for((i=(t=this.selectedCategory)==null?void 0:t.deselect)==null||i.invoke(),this.selectedCategory=void 0;(r=this.submenuContent)!=null&&r.firstChild;)(e=this.submenuContent)==null||e.removeChild(this.submenuContent.firstChild);(n=this.submenuRoot)==null||n.classList.add("close")}}E([o(G)],rt.prototype,"categories",2);const sn="https://upload.wikimedia.org/wikipedia/commons/2/21/City_locator_4.svg",nn=s=>{var i;const t=document.createElement("button");return t.classList.add("room"),t.classList.add("open-submenu"),t.innerHTML=`
        <button class="open-submenu">
            <span class="icon">
                <img src=${((i=s.icon)==null?void 0:i.url)??sn} alt=${s.title??"?"}>
            </span>
        </button>
    `,t},an=s=>{var e;const t=document.createElement("button");t.classList.add("submenu-button");const i=`
        <img src=${(e=s.icon)==null?void 0:e.url} alt=${s.name??"?"}>
    `,r=`
        <a>${s.name}</a>
    `;return s.icon&&(t.innerHTML+=i),t.innerHTML+=r,t},on=`
  <div class="mainmenu">
    <!-- Content -->
  </div>

  <div class="submenu-wrapper">
    <h2 class="submenu-title"></h2>
    <div class="submenu">
        <div class="submenu-content">
            <!-- Content -->
        </div>
    </div>
  </div>
`,ln=`
.mainmenu {
    position: absolute;
    top: 16px;
    right: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 54px;
    height: auto;
    background: rgba(229, 230, 233, 0.8);
    border-radius: 27px;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    box-shadow: 0 0 4px rgba(2, 2, 43, 0.2);
    z-index: 1;
    padding-top: 6px;

    /* default font settings */
    font-size: 1rem;
    font-family: 'Roboto Flex', sans-serif;
    /* font-optical-sizing: auto; */
    /* font-variation-settings: "width" 100; */
    color: rgb(40, 40, 40);
}

.mainmenu button {
    width: 42px;
    height: 42px;
    border: none;
    border-radius: 50%;
    margin-bottom: 4px;
    background: transparent;
    transition: background-color 0.5s;
    outline: rgba(0, 0, 0, 0) 1px solid;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.mainmenu button.active,
.mainmenu button:hover {
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.mainmenu button.active img,
.mainmenu button:hover img
{
    /* filter: invert(100%) sepia(0%) saturate(7478%) hue-rotate(317deg) brightness(109%) contrast(99%); */
}

.mainmenu button img {
    width: 32px;
    height: 32px;
}

.mainmenu button .state-icon {
    position: absolute;
    top: 9px;
    left: 11px;
    width: 32px; 
    height: 32px; 
    background-size: cover;
    background-repeat: no-repeat;
    pointer-events: none; 
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.mainmenu button.active .state-icon,
.mainmenu button:hover .state-icon
{
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

/*Submenu*/
.submenu-wrapper {
    position: absolute;
    top: 16px;
    right: calc(70px + 10px);
    width: 333px;
    max-height: 60vh;
    padding: 22px;
    z-index: 1;

    background: #ffffff5c;
    border: 1px solid rgba(255, 255, 255, .1);
    border-radius: 1.1999rem;
    outline: rgb(0 0 0 / 5%) 1px solid;
    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0, 0, 0, .05);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);

    overflow: hidden;
}

.submenu {
    overflow-x: hidden;
    overflow-y: scroll;
    max-height: calc(60vh - 22px * 2);
    font-family: 'Roboto Flex', sans-serif;
}

/* width */
.submenu::-webkit-scrollbar {
    scrollbar-color: #ff0000;
    width: 5px;
}

/* Track */
.submenu::-webkit-scrollbar-track {
    background: #8880;
    margin-right: 20px;
}

/* Handle */
.submenu::-webkit-scrollbar-thumb {
    background: #8888;
    border-radius: 10px; /* Rounded corners */
    margin: 0 8px; /* Offset the track to move the thumb left */
}

/* Handle on hover */
.submenu::-webkit-scrollbar-thumb:hover {
    background: #555A;
}

.submenu-title {
    color: #282828;
    font-size: 22px;
    font-weight: 800;
    line-height: 32px;
    margin-bottom: 16px;
    margin-top: 0px;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    border-bottom: 1px solid rgba(40, 40, 40, .4);
    font-family: 'Roboto Flex', sans-serif;
}

.submenu-button {
    height: 1.8rem;
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 1rem;
    line-height: 32px;
    border: none;
    cursor: pointer;
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 200;
    width: 100%;
    
    background: transparent;
    outline: rgba(0, 0, 0, 0) 1px solid;
    border-radius: 0.8rem;
}

.submenu-button:hover { 
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.submenu-button img {
    width: 32px;
    height: 32px;
    margin-right: 6px;
    margin-left: -6px;
}

.submenu-button a {
    color: #282828;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
}

.submenu-content img {
    max-width: 100%;
    height: auto;
    margin-right: 6px;
}

.special {
    display: flex;
    align-items: center;
    margin-top: 16px;
    font-size: 13px;
    line-height: 20px;
    color: #919191;
    border: none;
    background: none;
}

.special img {
    width: 16px;
    height: 16px;
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.submenu-wrapper.close {
    display: none;
}

@media screen and (max-width: 768px) {
    .mainmenu {
        width: 42px;
        height: auto;
        padding-bottom: 2px;
    }

    .mainmenu button {
        width: 32px;
        height: 32px;
    }

    .mainmenu button img {
        width: 24px;
        height: 24px;
    }

    .mainmenu button .state-icon {
        position: absolute;
        top: 9px;
        left: 9px;
        width: 24px; 
        height: 24px; 
    }

    .submenu-wrapper {
        right: calc(60px + 5px);
        width: 256px;
        border-radius: 21px;
        padding: 16px;
        max-height: 40vh;
    }

    .submenu {
        max-height: calc(40vh - 16px * 2);
    }

    .submenu-title {
        font-size: 18px;
        line-height: 28px;
        margin-bottom: 10px;
    }

    .submenu-button {
        margin-bottom: 6px;
        /* font-size: 1.3rem; */
        line-height: 24px;
    }

    .submenu-button img {
        width: 24px;
        height: 24px;
    }

    .special {
        margin-top: 10px;
        font-size: 11px;
    }

    .special img {
        width: 10px;
        height: 10px;
    }
}`;var hn=Object.defineProperty,cn=Object.getOwnPropertyDescriptor,R=(s,t,i,r)=>{for(var e=r>1?void 0:r?cn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&hn(t,i,e),e};class ae{}R([o(Ut)],ae.prototype,"button",2);R([o(Y)],ae.prototype,"label",2);class st extends l{constructor(){super(...arguments),this.categoryName="",this.data=[]}awake(){var i;this.galleryUI??(this.galleryUI=_e(rt));const t=(i=this.galleryUI)==null?void 0:i.categories.find(r=>r.title===this.categoryName);t&&this.data.forEach(r=>{var n,a;const e=new W;e.name=((n=r.label)==null?void 0:n.text)||"",e.icon=this.icon,e.click=new b,(a=e.click)==null||a.addEventListener(()=>{var c,p;(p=(c=r.button)==null?void 0:c.onClick)==null||p.invoke()}),t.items.push(e)})}}R([o(rt)],st.prototype,"galleryUI",2);R([o()],st.prototype,"categoryName",2);R([o(ft)],st.prototype,"icon",2);R([o(ae)],st.prototype,"data",2);var pn=Object.defineProperty,dn=Object.getOwnPropertyDescriptor,Xe=(s,t,i,r)=>{for(var e=r>1?void 0:r?dn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&pn(t,i,e),e};class jt extends l{constructor(){super(...arguments),this.title="",this.slug=""}initialize(t){this.galleryManager=t}start(){this.slug=mn(this.title),P("poi")===this.slug&&this.focus()}focus(){var t,i;Wt("poi",this.slug),(t=this.galleryManager)==null||t.poiFocused(this),this.cameraView&&(this.previousOrbitControls??(this.previousOrbitControls=_e(zt)),(i=this.previousOrbitControls)==null||i.setCameraAndLookTarget(this.cameraView))}focusNext(){var t;(t=this.galleryManager)==null||t.focusNext()}focusPrevious(){var t;(t=this.galleryManager)==null||t.focusPrevious()}}Xe([o(C)],jt.prototype,"cameraView",2);Xe([o()],jt.prototype,"title",2);function mn(s){return s.trim().toLowerCase().replace(/ /g,"-")}var un=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,nt=(s,t,i,r)=>{for(var e=r>1?void 0:r?fn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&un(t,i,e),e};class H extends l{constructor(){super(...arguments),this.pois=[],this.categoryName="",this.arrowKeysNavigation=!0,this.selectedPOIIndex=0}awake(){this.populateGalleryUI(this.pois),this.pois.forEach(t=>t.initialize(this))}populateGalleryUI(t){var r;if(!this.galleryUI)return;const i=(r=this.galleryUI)==null?void 0:r.categories.find(e=>e.title===this.categoryName);i&&t.forEach(e=>{const n=new W;n.name=e.title,n.icon=this.icon,n.click=new b,n.click.addEventListener(()=>{e.focus()}),i.items.push(n)})}poiFocused(t){const i=this.pois.indexOf(t);i!=-1&&(this.selectedPOIIndex=i)}focusNext(){var t;this.selectedPOIIndex=(this.selectedPOIIndex+1)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}focusPrevious(){var t;this.selectedPOIIndex=(this.selectedPOIIndex-1+this.pois.length)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}update(){if(this.arrowKeysNavigation){const t=this.context.input;t.isKeyDown("ArrowRight")?this.focusNext():t.isKeyDown("ArrowLeft")&&this.focusPrevious()}}}nt([o(jt)],H.prototype,"pois",2);nt([o(rt)],H.prototype,"galleryUI",2);nt([o()],H.prototype,"categoryName",2);nt([o(ft)],H.prototype,"icon",2);nt([o()],H.prototype,"arrowKeysNavigation",2);var gn=Object.defineProperty,bn=Object.getOwnPropertyDescriptor,Je=(s,t,i,r)=>{for(var e=r>1?void 0:r?bn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&gn(t,i,e),e};const Tt=P("debugmaterialx");class oe extends l{constructor(){super(...arguments),this.images=[]}async awake(){this.materialXAsset&&this.loadMaterialX(this.materialXAsset)}async loadMaterialX(t){const i=m.getComponent(this.gameObject,y);if(!i)return;const r=new Ui;r.resolveURL=a=>{if(a.startsWith("assets/"))return a;const p=a.split("/").pop();return Tt&&console.log("resolveURL",a,p),"assets/"+p};const n=await new Ki(r).setPath("").loadAsync(t).then(({materials:a})=>(Tt&&console.log("Loaded .mtlx materials",a),Object.values(a)[0]));Tt&&console.log("Loaded .mtlx material",n,t),n&&(i.sharedMaterial=n)}}Je([o(URL)],oe.prototype,"materialXAsset",2);Je([o(Ci)],oe.prototype,"images",2);const xn=P("debugmaterialx");class vn extends l{start(){const t=m.getComponent(this.gameObject,y);t&&(this.material=new Vi({}),t.sharedMaterial=this.material,this.constructNodeGraph(this.material),this.material.needsUpdate=!0)}constructNodeGraph(t){const i=Wi(1),r=Gi.mul(10).add(i),e=Ri(r);t.colorNode=e}update(){if(Q()&&this.material&&this.constructNodeGraph!==this.methodCacheKey){xn&&console.log("rebuilding node graph"),this.methodCacheKey=this.constructNodeGraph;try{this.constructNodeGraph(this.material),this.material.needsUpdate=!0}catch(t){throw console.error(t),f(t.message,ve.Error),t}}}}var wn=Object.defineProperty,_n=Object.getOwnPropertyDescriptor,On=(s,t,i,r)=>{for(var e=r>1?void 0:r?_n(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&wn(t,i,e),e};class Nt extends l{constructor(){super(...arguments),this.time=0,this._timeThreshold=.3}awake(){this._director=this.gameObject.getComponentInChildren(ji)??void 0}onAfterRender(){if(!this._director)return;Math.abs(this._director.time-this.time)>this._timeThreshold&&(this.time=this._director.time)}onTimeChanged(){!this._director||Math.abs(this._director.time-this.time)<this._timeThreshold||(this._director.time=this.time,this._director.isPlaying||this._director.evaluate())}}On([z(Nt.prototype.onTimeChanged)],Nt.prototype,"time",2);var yn=Object.defineProperty,Pn=Object.getOwnPropertyDescriptor,q=(s,t,i,r)=>{for(var e=r>1?void 0:r?Pn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&yn(t,i,e),e};class L extends l{constructor(){super(...arguments),this.consumeClick=!0,this.consumeDown=!0,this.consumeMove=!0,this.consumeUp=!0,this.consumeHover=!0,this.stopPropagation=!0}onPointerDown(t){this.consumeDown&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerMove(t){this.consumeMove&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerUp(t){this.consumeUp&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerClick(t){this.consumeClick&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerEnter(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerExit(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}}q([o()],L.prototype,"consumeClick",2);q([o()],L.prototype,"consumeDown",2);q([o()],L.prototype,"consumeMove",2);q([o()],L.prototype,"consumeUp",2);q([o()],L.prototype,"consumeHover",2);q([o()],L.prototype,"stopPropagation",2);var Cn=Object.defineProperty,jn=Object.getOwnPropertyDescriptor,Sn=(s,t,i,r)=>{for(var e=r>1?void 0:r?jn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Cn(t,i,e),e};class ti extends l{constructor(){super(...arguments),this.renderers=[]}select(t){this.renderers.forEach(i=>{i.probeAnchor=t})}}Sn([o(y)],ti.prototype,"renderers",2);var Dn=Object.defineProperty,Tn=Object.getOwnPropertyDescriptor,En=(s,t,i,r)=>{for(var e=r>1?void 0:r?Tn(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Dn(t,i,e),e};class le extends l{constructor(){super(...arguments),this.displayName=""}}En([o()],le.prototype,"displayName",2);var Mn=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,St=(s,t,i,r)=>{for(var e=r>1?void 0:r?$n(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&Mn(t,i,e),e};class at extends l{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0);const t=P("variant");typeof t=="string"?this.index=parseInt(t):typeof t=="number"&&(this.index=t),this.apply()}next(){this.select(this.index+1)}previous(){this.select(this.index-1)}apply(){for(let t=0;t<this.objects.length;t++)this.objects[t].visible=t===this.index;if(this.lable){const t=this.objects[this.index];if(t){const i=m.getComponent(t,le);this.lable.text=(i==null?void 0:i.displayName)??t.name}}}select(t){t<0&&(t=this.objects.length-1),this.index=t%this.objects.length,this.index=w.clamp(this.index,0,this.objects.length-1),Wt("variant",this.index.toString()),this.apply()}}St([o(C)],at.prototype,"objects",2);St([o()],at.prototype,"hideContentOnStart",2);St([o(Y)],at.prototype,"lable",2);St([z(function(){this.apply()})],at.prototype,"index",2);h.add("AspectRatioFitterUI",qt);h.add("CameraGoal",gt);h.add("CameraLayer",Bi);h.add("Cannon",Z);h.add("RandomColor",Qt);h.add("ChangeColorOnCollision",ir);h.add("IncreaseShaderSpeedOverTime",Se);h.add("ClickButton",De);h.add("ClickToReset",Te);h.add("DepthOfFieldController",xt);h.add("DisableEnvironmentLight",ur);h.add("EmitParticlesOnClick",Ee);h.add("EnforceParameters",Me);h.add("HTMLButtonClick",Zt);h.add("HTMLMenu",kt);h.add("IFrameContent",k);h.add("ImageTrackingDownloadUI",Dr);h.add("LODGroupUI",Bt);h.add("Networking_ClickToChangeColor",At);h.add("Networking_StringArray",It);h.add("Networking_Object",Lt);h.add("PerformanceSettings",Jt);h.add("Photographer",B);h.add("PhysicsCollision",X);h.add("PhysicsTrigger",J);h.add("PlayAnimationOnCollision",Fe);h.add("PlayAnimationOnTrigger",Ne);h.add("PlayAudioOnCollision",ze);h.add("ResetAnimationsForXR",Zr);h.add("ResponsiveContent",te);h.add("LoadingSceneRoot",Ve);h.add("SceneLoadingEvents",ie);h.add("SceneSwitcherControls",ts);h.add("SetBackfaceCulling",es);h.add("ShowBalloonMessage",We);h.add("SimpleLeaderboard",Ft);h.add("StartPosition",Ge);h.add("AutoReset",Re);h.add("SyncedRoomUI",He);h.add("TimedSpawn",qe);h.add("TopMenu",Ke);h.add("VideoBackground",_s);h.add("ResetPositionOnInterval",tt);h.add("ToggleVisibility",Ps);h.add("WireframeMaterial",Qe);h.add("XRLifecycleEvents",re);h.add("WebXRBodyTracking",Es);h.add("Arrow",se);h.add("ArrowShooting",j);h.add("BowArrowTarget",ke);h.add("BowTargetSpawner",Be);h.add("CustomDepthSensing",Hs);h.add("DeviceDetection",qs);h.add("CustomUSDSettings",Ks);h.add("FadeOnProximity",U);h.add("PlayAnimationOnProximity",Ot);h.add("SoundOnProximity",it);h.add("EverywhereConfigurator",Ct);h.add("ButtonAndTextFiller",st);h.add("GalleryManager",H);h.add("GalleryPOI",jt);h.add("GalleryUI",rt);h.add("MaterialXAsset",oe);h.add("ShadeWithMaterialX",vn);h.add("SyncedPlayableDirector",Nt);h.add("ConsumeAllPointers",L);h.add("ReflectionsSwitcher",ti);h.add("VariantInfo",le);h.add("VariantSwitcher",at);class An extends l{update(){this.gameObject.rotateY(this.context.time.deltaTime)}}var In=Object.defineProperty,Ln=Object.getOwnPropertyDescriptor,ei=(s,t,i,r)=>{for(var e=r>1?void 0:r?Ln(t,i):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(r?a(t,i,e):a(e))||e);return r&&e&&In(t,i,e),e};class he extends l{constructor(){super(...arguments);K(this,"htmlSelector","button.some-button");K(this,"onClick",new b);K(this,"element");K(this,"onClicked",()=>{this.onClick.invoke()})}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}ei([u()],he.prototype,"htmlSelector",2);ei([o(b)],he.prototype,"onClick",2);class Fn extends l{active(){console.log("觸發按鈕"),this.gameObject.visible=!this.gameObject.visible}}h.add("AutoRote",An);h.add("DomBtn",he);h.add("ObjCtrl",Fn);
